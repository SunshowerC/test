<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>注册</title>
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="assets/css/register.css">
</head>
<body>
<!-- Button trigger modal -->
<button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#register-modal"> 注册</button>

<!-- Modal -->
<div class="modal fade" id="register-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <h4 class="modal-title">加入时间银行</h4>
                <p class="modal-title2">让世界为你提供的帮助欢呼</p>
                <p id="info"></p>
                <hr class="border-divided">
                <form id="form" action="login.html">
                    <input type="text" required placeholder="姓名" class="text" id="stuName" name="stuName"/>
                    <hr class="border-divided">
                    <input type="text" required pattern="^1[3|4|5|7|8]\d{9}$" placeholder="手机号" class="phone"
                           name="phone" id="phone"/>
                    <input type="button" class="btn btn-primary get-check" id="getVerifyCode" value="获取验证码"/>
                    <hr class="border-divided">
                    <input type="text" required placeholder="验证码" class="text" id="verifyCode">
                    <hr class="border-divided">
                    <input type="password" required pattern="\w{6,16}$" placeholder="密码(限制6-16位，字母数字或下划线)" class="text"
                           id="password" name="password">
                    <hr class="border-divided">
                    <input type="password" required pattern="\w{6,16}$" placeholder="再次输入密码" class="text"
                           id="confirm-password" name="confirm-password">
                    <hr class="border-divided">
                    <input type="submit" class="btn btn-primary yes" value="注册" id="register"/>
                    <span>已有帐号？</span>
                    <a class="fail" href="#">登陆</a>
                </form>
            </div>
        </div>
    </div>
</div>
<script src="scripts/jquery-1.11.3/jquery.js"></script>
<script src="bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        var wait = 60;

        function time(o) {
            if (wait == 0) {
                o.removeAttribute("disabled");
                o.value = "获取验证码";
                wait = 60;
            } else {
                o.setAttribute("disabled", true);
                o.value = "重新发送(" + wait + ")";
                wait--;
                setTimeout(function () {
                            time(o)
                        },
                        1000)
            }
        }

        $("#getVerifyCode").on("click", function () {
            time(this)
        });

        $("#register").click(function () {	//按钮点击事件
            var stuName = $("#stuName").val();
            var phone = $("#phone").val();
            var password = $("#password").val();
            var confirmPassword = $("#confirm-password").val();
            var verifyCode = $("#verifyCode").val();
            var param = {
                stuName: $("#stuName").val(),
                phone: $("#phone").val(),
                password: $("#password").val()
            }
            if (!stuName && !phone && !verifyCode && !password && !confirmPassword) {
                alert('请将表填完整！');
                return;
            }
            ;
            if (/^1[3|4|5|7|8]\d{9}$/.test(phone) == false) {
                alert("手机号码格式错误！");
                return;
            }
            ;
            if (/\w{6,16}$/.test(password) == false) {
                alert("密码格式错误！");
                return;
            }
            ;
            if (password != confirmPassword) {
                alert("两次输入的密码不一致！");
                return;
            }
            ;
            //还差检验验证码是否正确,后期加上
            $('#register').val("注册中...");
            $('#register').prop('disabled', true);
            $.ajax({
                type: "POST", //与后端沟通好用get还是post
                dataType: "json",
                crossDomain: true,
                url: "http://192.168.20.21:3000/user/signup",//与后端沟通好发送的地址
                cache: false,//忽略缓存
                data: param,//与后端沟通好名称，那个newDate（）是为了读取最新的数据
                success: function (data) {
                    $('#register').val("注册");
                    $('#register').prop('disabled', false);
                    if (data.statusCode == 101) {//与后端沟通好什么符号表示成功
                        window.location = "login.html";//加载登录后的页面
                    }
                    else {
                        alert(data.message);
                        return false;
                    }
                },
                error: function () {
                    $('#register').val('重新注册');
                    $('#register').prop('disabled', false);
                    alert('注册失败，请检查网络连接！');
                }
            });
        });

    })
</script>
</body>
</html>